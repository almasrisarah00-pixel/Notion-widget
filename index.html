<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Daily Magic Card</title>
  <style>
    body {
      margin: 0;
      padding: 1rem;
      font-family: sans-serif;
      background: #f8f8f8;
      text-align: center;
    }
    img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <h3>Daily MTG Card</h3>
  <div id="card-container">Loading...</div>

  <script>
    // Deterministic PRNG (Mulberry32)
    function mulberry32(a) {
      return function() {
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      }
    }

    // Generate seed from current UTC date (YYYYMMDD)
    function getUTCDateSeed() {
      const now = new Date();
      const year = now.getUTCFullYear();
      const month = now.getUTCMonth();
      const day = now.getUTCDate();
      return parseInt(`${year}${String(month).padStart(2, '0')}${String(day).padStart(2, '0')}`);
    }

    async function getDailyRandomCard() {
      const seed = getUTCDateSeed();
      const rng = mulberry32(seed); // consistent daily PRNG

      const totalCards = 25000; // estimate
      const pageSize = 175;
      const cardIndex = Math.floor(rng() * totalCards);

      const page = Math.floor(cardIndex / pageSize) + 1;
      const position = cardIndex % pageSize;

      try {
        const response = await fetch(`https://api.scryfall.com/cards/search?q=*&order=set&unique=cards&page=${page}`);
        const data = await response.json();

        if (!data || !data.data || !data.data[position]) {
          document.getElementById('card-container').innerText = 'Card not found.';
          return;
        }

        const card = data.data[position];
        const imageUrl = card.image_uris?.normal || card.card_faces?.[0]?.image_uris?.normal;

        if (imageUrl) {
          document.getElementById('card-container').innerHTML = `
            <img src="${imageUrl}" alt="${card.name}" />
            <p>${card.name}</p>
          `;
        } else {
          document.getElementById('card-container').innerText = 'Image not available.';
        }
      } catch (e) {
        console.error(e);
        document.getElementById('card-container').innerText = 'Error loading card.';
      }
    }

    getDailyRandomCard();
  </script>
</body>
</html>
